\hypertarget{fortuna_8c}{}\section{M\+:/\+Office/!\+Doutorado/0. Repositorio\+S\+V\+N/\+H\+A\+M\+S\+T\+E\+R\+\_\+\+Prototype/branches/\+J\+I\+N\+T2018/include/libtomcrypt-\/develop/src/prngs/fortuna.c File Reference}
\label{fortuna_8c}\index{M:/Office/"!Doutorado/0. RepositorioSVN/HAMSTER\_Prototype/branches/JINT2018/include/libtomcrypt-\/develop/src/prngs/fortuna.c@{M:/Office/"!Doutorado/0. RepositorioSVN/HAMSTER\_Prototype/branches/JINT2018/include/libtomcrypt-\/develop/src/prngs/fortuna.c}}


Fortuna P\+R\+NG, Tom St Denis.  


{\ttfamily \#include \char`\"{}tomcrypt\+\_\+private.\+h\char`\"{}}\newline
Include dependency graph for fortuna.\+c\+:
% FIG 0
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \mbox{\hyperlink{fortuna_8c_a5e5b2b7f0a18fae044e2f53384a51c6b}{\+\_\+fortuna\+\_\+update\+\_\+iv}} (\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$prng)
\item 
static int \mbox{\hyperlink{fortuna_8c_aad833baa2e75f93d847e5a7ac30ea4d2}{\+\_\+fortuna\+\_\+reseed}} (\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$prng)
\item 
int \mbox{\hyperlink{fortuna_8c_a8a0df3516c28ad940932db01cfa194f9}{fortuna\+\_\+update\+\_\+seed}} (const unsigned char $\ast$in, unsigned long inlen, \mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$prng)
\begin{DoxyCompactList}\small\item\em \char`\"{}\+Update Seed File\char`\"{}-\/compliant update of K \end{DoxyCompactList}\item 
int \mbox{\hyperlink{fortuna_8c_a54822f5e172e6f2a025448f6e9430e22}{fortuna\+\_\+start}} (\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$prng)
\begin{DoxyCompactList}\small\item\em Start the P\+R\+NG. \end{DoxyCompactList}\item 
static int \mbox{\hyperlink{fortuna_8c_a0cff2bb145d08bfcc0c89c7c5bb25d30}{\+\_\+fortuna\+\_\+add}} (unsigned long source, unsigned long pool, const unsigned char $\ast$in, unsigned long inlen, \mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$prng)
\item 
int \mbox{\hyperlink{fortuna_8c_a66d3692e58fba2dc439709f197f5cff0}{fortuna\+\_\+add\+\_\+random\+\_\+event}} (unsigned long source, unsigned long pool, const unsigned char $\ast$in, unsigned long inlen, \mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$prng)
\begin{DoxyCompactList}\small\item\em Add random event to the P\+R\+NG state as proposed by the original paper. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{fortuna_8c_ad94b1b4f59e40bd1409a4f2dc46065c3}{fortuna\+\_\+add\+\_\+entropy}} (const unsigned char $\ast$in, unsigned long inlen, \mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$prng)
\begin{DoxyCompactList}\small\item\em Add entropy to the P\+R\+NG state. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{fortuna_8c_a635d034d99b51a38b4a71fae3880b48f}{fortuna\+\_\+ready}} (\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$prng)
\begin{DoxyCompactList}\small\item\em Make the P\+R\+NG ready to read from. \end{DoxyCompactList}\item 
unsigned long \mbox{\hyperlink{fortuna_8c_a19149fcfc926ab81d4acebfcf39b78f7}{fortuna\+\_\+read}} (unsigned char $\ast$out, unsigned long outlen, \mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$prng)
\begin{DoxyCompactList}\small\item\em Read from the P\+R\+NG. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{fortuna_8c_ab875173ff3316ba29598b7fb3b03f186}{fortuna\+\_\+done}} (\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$prng)
\begin{DoxyCompactList}\small\item\em Terminate the P\+R\+NG. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{fortuna_8c_a6e655bf4b2449fc071e55c8b2ed39ae4}{fortuna\+\_\+export}} (unsigned char $\ast$out, unsigned long $\ast$outlen, \mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$prng)
\begin{DoxyCompactList}\small\item\em Export the P\+R\+NG state. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{fortuna_8c_ad9f529aaecf6646cac5e5eaa2d1f418d}{fortuna\+\_\+import}} (const unsigned char $\ast$in, unsigned long inlen, \mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$prng)
\begin{DoxyCompactList}\small\item\em Import a P\+R\+NG state. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{fortuna_8c_a02a8621eda36a40059ce155007b6f6c3}{fortuna\+\_\+test}} (void)
\begin{DoxyCompactList}\small\item\em P\+R\+NG self-\/test. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const struct \mbox{\hyperlink{structltc__prng__descriptor}{ltc\+\_\+prng\+\_\+descriptor}} \mbox{\hyperlink{fortuna_8c_a58d667818369213be05a67ff635ebb78}{fortuna\+\_\+desc}}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Fortuna P\+R\+NG, Tom St Denis. 



\subsection{Function Documentation}
\mbox{\Hypertarget{fortuna_8c_a0cff2bb145d08bfcc0c89c7c5bb25d30}\label{fortuna_8c_a0cff2bb145d08bfcc0c89c7c5bb25d30}} 
\index{fortuna.c@{fortuna.c}!\_fortuna\_add@{\_fortuna\_add}}
\index{\_fortuna\_add@{\_fortuna\_add}!fortuna.c@{fortuna.c}}
\subsubsection{\texorpdfstring{\_fortuna\_add()}{\_fortuna\_add()}}
{\footnotesize\ttfamily static int \+\_\+fortuna\+\_\+add (\begin{DoxyParamCaption}\item[{unsigned long}]{source,  }\item[{unsigned long}]{pool,  }\item[{const unsigned char $\ast$}]{in,  }\item[{unsigned long}]{inlen,  }\item[{\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$}]{prng }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 258 of file fortuna.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{259 \{}
\DoxyCodeLine{260    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[2];}
\DoxyCodeLine{261    \textcolor{keywordtype}{int} err;}
\DoxyCodeLine{262 }
\DoxyCodeLine{263    \textcolor{comment}{/* ensure inlen <= 32 */}}
\DoxyCodeLine{264    \textcolor{keywordflow}{if} (inlen > 32) \{}
\DoxyCodeLine{265       inlen = 32;}
\DoxyCodeLine{266    \}}
\DoxyCodeLine{267 }
\DoxyCodeLine{268    \textcolor{comment}{/* add s || length(in) || in to pool[pool\_idx] */}}
\DoxyCodeLine{269    tmp[0] = (\textcolor{keywordtype}{unsigned} char)source;}
\DoxyCodeLine{270    tmp[1] = (\textcolor{keywordtype}{unsigned} char)inlen;}
\DoxyCodeLine{271 }
\DoxyCodeLine{272    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{sha256_8c_a8b983a80c9edd5d997a3937963ae7856}{sha256\_process}}(\&prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool[pool], tmp, 2)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{273       \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{274    \}}
\DoxyCodeLine{275    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{sha256_8c_a8b983a80c9edd5d997a3937963ae7856}{sha256\_process}}(\&prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool[pool], in, inlen)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{276       \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{277    \}}
\DoxyCodeLine{278    \textcolor{keywordflow}{if} (pool == 0) \{}
\DoxyCodeLine{279       prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool0\_len += inlen;}
\DoxyCodeLine{280    \}}
\DoxyCodeLine{281    \textcolor{keywordflow}{return} \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}; \textcolor{comment}{/* success */}}
\DoxyCodeLine{282 \}}

\end{DoxyCode}


References C\+R\+Y\+P\+T\+\_\+\+OK, sha256\+\_\+process(), and prng\+\_\+state\+::u.



Referenced by fortuna\+\_\+add\+\_\+entropy(), and fortuna\+\_\+add\+\_\+random\+\_\+event().

Here is the call graph for this function\+:
% FIG 1
Here is the caller graph for this function\+:
% FIG 2
\mbox{\Hypertarget{fortuna_8c_aad833baa2e75f93d847e5a7ac30ea4d2}\label{fortuna_8c_aad833baa2e75f93d847e5a7ac30ea4d2}} 
\index{fortuna.c@{fortuna.c}!\_fortuna\_reseed@{\_fortuna\_reseed}}
\index{\_fortuna\_reseed@{\_fortuna\_reseed}!fortuna.c@{fortuna.c}}
\subsubsection{\texorpdfstring{\_fortuna\_reseed()}{\_fortuna\_reseed()}}
{\footnotesize\ttfamily static int \+\_\+fortuna\+\_\+reseed (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$}]{prng }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 102 of file fortuna.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{103 \{}
\DoxyCodeLine{104    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[\mbox{\hyperlink{tomcrypt_8h_ab59933beebb2b857c992b93cf53f0d10}{MAXBLOCKSIZE}}];}
\DoxyCodeLine{105    \mbox{\hyperlink{unionHash__state}{hash\_state}}    md;}
\DoxyCodeLine{106    \mbox{\hyperlink{tomcrypt__cfg_8h_ab4afaf24b39288a7be6fd03fe8345f61}{ulong64}}       reset\_cnt;}
\DoxyCodeLine{107    \textcolor{keywordtype}{int}           err, x;}
\DoxyCodeLine{108 }
\DoxyCodeLine{109 \textcolor{preprocessor}{\#ifdef LTC\_FORTUNA\_RESEED\_RATELIMIT\_TIMED}}
\DoxyCodeLine{110    \mbox{\hyperlink{tomcrypt__cfg_8h_ab4afaf24b39288a7be6fd03fe8345f61}{ulong64}} now = \_fortuna\_current\_time();}
\DoxyCodeLine{111    \textcolor{keywordflow}{if} (now == prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.wd) \{}
\DoxyCodeLine{112       \textcolor{keywordflow}{return} \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}};}
\DoxyCodeLine{113    \}}
\DoxyCodeLine{114 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{115    \textcolor{keywordflow}{if} (++prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.wd < \mbox{\hyperlink{tomcrypt__custom_8h_af58a920e681cb68756017d8364e4a692}{LTC\_FORTUNA\_WD}}) \{}
\DoxyCodeLine{116       \textcolor{keywordflow}{return} \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}};}
\DoxyCodeLine{117    \}}
\DoxyCodeLine{118 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{119 }
\DoxyCodeLine{120    \textcolor{comment}{/* new K == LTC\_SHA256(K || s) where s == LTC\_SHA256(P0) || LTC\_SHA256(P1) ... */}}
\DoxyCodeLine{121    \mbox{\hyperlink{sha256_8c_a6290ad544b02c822c2ca6c30b8d1ee07}{sha256\_init}}(\&md);}
\DoxyCodeLine{122    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{sha256_8c_a8b983a80c9edd5d997a3937963ae7856}{sha256\_process}}(\&md, prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.K, 32)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{123       \mbox{\hyperlink{sha256_8c_a53db56f3eb9f35c59b134533be31c301}{sha256\_done}}(\&md, tmp);}
\DoxyCodeLine{124       \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{125    \}}
\DoxyCodeLine{126 }
\DoxyCodeLine{127    reset\_cnt = prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.reset\_cnt + 1;}
\DoxyCodeLine{128 }
\DoxyCodeLine{129    \textcolor{keywordflow}{for} (x = 0; x < \mbox{\hyperlink{tomcrypt__custom_8h_aa38cc64a9bea21aba17c1936b453f77b}{LTC\_FORTUNA\_POOLS}}; x++) \{}
\DoxyCodeLine{130        \textcolor{keywordflow}{if} (x == 0 || ((reset\_cnt >> (x-1)) \& 1) == 0) \{}
\DoxyCodeLine{131           \textcolor{comment}{/* terminate this hash */}}
\DoxyCodeLine{132           \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{sha256_8c_a53db56f3eb9f35c59b134533be31c301}{sha256\_done}}(\&prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool[x], tmp)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{133              \mbox{\hyperlink{sha256_8c_a53db56f3eb9f35c59b134533be31c301}{sha256\_done}}(\&md, tmp);}
\DoxyCodeLine{134              \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{135           \}}
\DoxyCodeLine{136           \textcolor{comment}{/* add it to the string */}}
\DoxyCodeLine{137           \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{sha256_8c_a8b983a80c9edd5d997a3937963ae7856}{sha256\_process}}(\&md, tmp, 32)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{138              \mbox{\hyperlink{sha256_8c_a53db56f3eb9f35c59b134533be31c301}{sha256\_done}}(\&md, tmp);}
\DoxyCodeLine{139              \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{140           \}}
\DoxyCodeLine{141           \textcolor{comment}{/* reset this pool */}}
\DoxyCodeLine{142           \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{sha256_8c_a6290ad544b02c822c2ca6c30b8d1ee07}{sha256\_init}}(\&prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool[x])) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{143              \mbox{\hyperlink{sha256_8c_a53db56f3eb9f35c59b134533be31c301}{sha256\_done}}(\&md, tmp);}
\DoxyCodeLine{144              \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{145           \}}
\DoxyCodeLine{146        \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{147           \textcolor{keywordflow}{break};}
\DoxyCodeLine{148        \}}
\DoxyCodeLine{149    \}}
\DoxyCodeLine{150 }
\DoxyCodeLine{151    \textcolor{comment}{/* finish key */}}
\DoxyCodeLine{152    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{sha256_8c_a53db56f3eb9f35c59b134533be31c301}{sha256\_done}}(\&md, prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.K)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{153       \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{154    \}}
\DoxyCodeLine{155    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{aes_8c_a3b2fab908c22514c91332a5c9a3d7166}{rijndael\_setup}}(prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.K, 32, 0, \&prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.skey)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{156       \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{157    \}}
\DoxyCodeLine{158    \mbox{\hyperlink{fortuna_8c_a5e5b2b7f0a18fae044e2f53384a51c6b}{\_fortuna\_update\_iv}}(prng);}
\DoxyCodeLine{159 }
\DoxyCodeLine{160    \textcolor{comment}{/* reset/update internals */}}
\DoxyCodeLine{161    prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool0\_len = 0;}
\DoxyCodeLine{162 \textcolor{preprocessor}{\#ifdef LTC\_FORTUNA\_RESEED\_RATELIMIT\_TIMED}}
\DoxyCodeLine{163    prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.wd        = now;}
\DoxyCodeLine{164 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{165    prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.wd        = 0;}
\DoxyCodeLine{166 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{167    prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.reset\_cnt = reset\_cnt;}
\DoxyCodeLine{168 }
\DoxyCodeLine{169 }
\DoxyCodeLine{170 \textcolor{preprocessor}{\#ifdef LTC\_CLEAN\_STACK}}
\DoxyCodeLine{171    \mbox{\hyperlink{tomcrypt__misc_8h_a63b6e188713790263bfd3612fe8b398f}{zeromem}}(\&md, \textcolor{keyword}{sizeof}(md));}
\DoxyCodeLine{172    \mbox{\hyperlink{tomcrypt__misc_8h_a63b6e188713790263bfd3612fe8b398f}{zeromem}}(tmp, \textcolor{keyword}{sizeof}(tmp));}
\DoxyCodeLine{173 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{174 }
\DoxyCodeLine{175    \textcolor{keywordflow}{return} \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}};}
\DoxyCodeLine{176 \}}

\end{DoxyCode}


References \+\_\+fortuna\+\_\+update\+\_\+iv(), C\+R\+Y\+P\+T\+\_\+\+OK, L\+T\+C\+\_\+\+F\+O\+R\+T\+U\+N\+A\+\_\+\+P\+O\+O\+LS, L\+T\+C\+\_\+\+F\+O\+R\+T\+U\+N\+A\+\_\+\+WD, M\+A\+X\+B\+L\+O\+C\+K\+S\+I\+ZE, rijndael\+\_\+setup(), sha256\+\_\+done(), sha256\+\_\+init(), sha256\+\_\+process(), prng\+\_\+state\+::u, and zeromem().



Referenced by fortuna\+\_\+read(), and fortuna\+\_\+ready().

Here is the call graph for this function\+:
% FIG 3
Here is the caller graph for this function\+:
% FIG 4
\mbox{\Hypertarget{fortuna_8c_a5e5b2b7f0a18fae044e2f53384a51c6b}\label{fortuna_8c_a5e5b2b7f0a18fae044e2f53384a51c6b}} 
\index{fortuna.c@{fortuna.c}!\_fortuna\_update\_iv@{\_fortuna\_update\_iv}}
\index{\_fortuna\_update\_iv@{\_fortuna\_update\_iv}!fortuna.c@{fortuna.c}}
\subsubsection{\texorpdfstring{\_fortuna\_update\_iv()}{\_fortuna\_update\_iv()}}
{\footnotesize\ttfamily static void \+\_\+fortuna\+\_\+update\+\_\+iv (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$}]{prng }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Definition at line 62 of file fortuna.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{63 \{}
\DoxyCodeLine{64    \textcolor{keywordtype}{int}            x;}
\DoxyCodeLine{65    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *IV;}
\DoxyCodeLine{66    \textcolor{comment}{/* update IV */}}
\DoxyCodeLine{67    IV = prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.IV;}
\DoxyCodeLine{68    \textcolor{keywordflow}{for} (x = 0; x < 16; x++) \{}
\DoxyCodeLine{69       IV[x] = (IV[x] + 1) \& 255;}
\DoxyCodeLine{70       \textcolor{keywordflow}{if} (IV[x] != 0) \textcolor{keywordflow}{break};}
\DoxyCodeLine{71    \}}
\DoxyCodeLine{72 \}}

\end{DoxyCode}


References prng\+\_\+state\+::u.



Referenced by \+\_\+fortuna\+\_\+reseed(), fortuna\+\_\+read(), and fortuna\+\_\+update\+\_\+seed().

Here is the caller graph for this function\+:
% FIG 5
\mbox{\Hypertarget{fortuna_8c_ad94b1b4f59e40bd1409a4f2dc46065c3}\label{fortuna_8c_ad94b1b4f59e40bd1409a4f2dc46065c3}} 
\index{fortuna.c@{fortuna.c}!fortuna\_add\_entropy@{fortuna\_add\_entropy}}
\index{fortuna\_add\_entropy@{fortuna\_add\_entropy}!fortuna.c@{fortuna.c}}
\subsubsection{\texorpdfstring{fortuna\_add\_entropy()}{fortuna\_add\_entropy()}}
{\footnotesize\ttfamily int fortuna\+\_\+add\+\_\+entropy (\begin{DoxyParamCaption}\item[{const unsigned char $\ast$}]{in,  }\item[{unsigned long}]{inlen,  }\item[{\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$}]{prng }\end{DoxyParamCaption})}



Add entropy to the P\+R\+NG state. 


\begin{DoxyParams}{Parameters}
{\em in} & The data to add \\
\hline
{\em inlen} & Length of the data to add \\
\hline
{\em prng} & P\+R\+NG state to update \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
C\+R\+Y\+P\+T\+\_\+\+OK if successful 
\end{DoxyReturn}


Definition at line 319 of file fortuna.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{320 \{}
\DoxyCodeLine{321    \textcolor{keywordtype}{int} err;}
\DoxyCodeLine{322 }
\DoxyCodeLine{323    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(prng != NULL);}
\DoxyCodeLine{324    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(in != NULL);}
\DoxyCodeLine{325    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(inlen > 0);}
\DoxyCodeLine{326 }
\DoxyCodeLine{327    \mbox{\hyperlink{tomcrypt__custom_8h_a427a107414e4d775fbf23f4a499f4a31}{LTC\_MUTEX\_LOCK}}(\&prng->lock);}
\DoxyCodeLine{328 }
\DoxyCodeLine{329    err = \mbox{\hyperlink{fortuna_8c_a0cff2bb145d08bfcc0c89c7c5bb25d30}{\_fortuna\_add}}(0, prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool\_idx, in, inlen, prng);}
\DoxyCodeLine{330 }
\DoxyCodeLine{331    \textcolor{keywordflow}{if} (err == \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{332       ++(prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool\_idx);}
\DoxyCodeLine{333       prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool\_idx \%= \mbox{\hyperlink{tomcrypt__custom_8h_aa38cc64a9bea21aba17c1936b453f77b}{LTC\_FORTUNA\_POOLS}};}
\DoxyCodeLine{334    \}}
\DoxyCodeLine{335 }
\DoxyCodeLine{336    \mbox{\hyperlink{tomcrypt__custom_8h_acdf267be91b178b4fafe8f992d57a7f1}{LTC\_MUTEX\_UNLOCK}}(\&prng->lock);}
\DoxyCodeLine{337 }
\DoxyCodeLine{338    \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{339 \}}

\end{DoxyCode}


References \+\_\+fortuna\+\_\+add(), C\+R\+Y\+P\+T\+\_\+\+OK, L\+T\+C\+\_\+\+A\+R\+G\+C\+HK, L\+T\+C\+\_\+\+F\+O\+R\+T\+U\+N\+A\+\_\+\+P\+O\+O\+LS, L\+T\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+\+L\+O\+CK, L\+T\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+\+U\+N\+L\+O\+CK, and prng\+\_\+state\+::u.

Here is the call graph for this function\+:
% FIG 6
\mbox{\Hypertarget{fortuna_8c_a66d3692e58fba2dc439709f197f5cff0}\label{fortuna_8c_a66d3692e58fba2dc439709f197f5cff0}} 
\index{fortuna.c@{fortuna.c}!fortuna\_add\_random\_event@{fortuna\_add\_random\_event}}
\index{fortuna\_add\_random\_event@{fortuna\_add\_random\_event}!fortuna.c@{fortuna.c}}
\subsubsection{\texorpdfstring{fortuna\_add\_random\_event()}{fortuna\_add\_random\_event()}}
{\footnotesize\ttfamily int fortuna\+\_\+add\+\_\+random\+\_\+event (\begin{DoxyParamCaption}\item[{unsigned long}]{source,  }\item[{unsigned long}]{pool,  }\item[{const unsigned char $\ast$}]{in,  }\item[{unsigned long}]{inlen,  }\item[{\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$}]{prng }\end{DoxyParamCaption})}



Add random event to the P\+R\+NG state as proposed by the original paper. 


\begin{DoxyParams}{Parameters}
{\em source} & The source this random event comes from (0 .. 255) \\
\hline
{\em pool} & The pool where to add the data to (0 .. L\+T\+C\+\_\+\+F\+O\+R\+T\+U\+N\+A\+\_\+\+P\+O\+O\+LS) \\
\hline
{\em in} & The data to add \\
\hline
{\em inlen} & Length of the data to add \\
\hline
{\em prng} & P\+R\+NG state to update \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
C\+R\+Y\+P\+T\+\_\+\+OK if successful 
\end{DoxyReturn}


Definition at line 293 of file fortuna.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{294 \{}
\DoxyCodeLine{295    \textcolor{keywordtype}{int}           err;}
\DoxyCodeLine{296 }
\DoxyCodeLine{297    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(prng != NULL);}
\DoxyCodeLine{298    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(in != NULL);}
\DoxyCodeLine{299    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(inlen > 0);}
\DoxyCodeLine{300    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(source <= 255);}
\DoxyCodeLine{301    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(pool < \mbox{\hyperlink{tomcrypt__custom_8h_aa38cc64a9bea21aba17c1936b453f77b}{LTC\_FORTUNA\_POOLS}});}
\DoxyCodeLine{302 }
\DoxyCodeLine{303    \mbox{\hyperlink{tomcrypt__custom_8h_a427a107414e4d775fbf23f4a499f4a31}{LTC\_MUTEX\_LOCK}}(\&prng->lock);}
\DoxyCodeLine{304 }
\DoxyCodeLine{305    err = \mbox{\hyperlink{fortuna_8c_a0cff2bb145d08bfcc0c89c7c5bb25d30}{\_fortuna\_add}}(source, pool, in, inlen, prng);}
\DoxyCodeLine{306 }
\DoxyCodeLine{307    \mbox{\hyperlink{tomcrypt__custom_8h_acdf267be91b178b4fafe8f992d57a7f1}{LTC\_MUTEX\_UNLOCK}}(\&prng->lock);}
\DoxyCodeLine{308 }
\DoxyCodeLine{309    \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{310 \}}

\end{DoxyCode}


References \+\_\+fortuna\+\_\+add(), L\+T\+C\+\_\+\+A\+R\+G\+C\+HK, L\+T\+C\+\_\+\+F\+O\+R\+T\+U\+N\+A\+\_\+\+P\+O\+O\+LS, L\+T\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+\+L\+O\+CK, and L\+T\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+\+U\+N\+L\+O\+CK.

Here is the call graph for this function\+:
% FIG 7
\mbox{\Hypertarget{fortuna_8c_ab875173ff3316ba29598b7fb3b03f186}\label{fortuna_8c_ab875173ff3316ba29598b7fb3b03f186}} 
\index{fortuna.c@{fortuna.c}!fortuna\_done@{fortuna\_done}}
\index{fortuna\_done@{fortuna\_done}!fortuna.c@{fortuna.c}}
\subsubsection{\texorpdfstring{fortuna\_done()}{fortuna\_done()}}
{\footnotesize\ttfamily int fortuna\+\_\+done (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$}]{prng }\end{DoxyParamCaption})}



Terminate the P\+R\+NG. 


\begin{DoxyParams}{Parameters}
{\em prng} & The P\+R\+NG to terminate \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
C\+R\+Y\+P\+T\+\_\+\+OK if successful 
\end{DoxyReturn}


Definition at line 441 of file fortuna.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{442 \{}
\DoxyCodeLine{443    \textcolor{keywordtype}{int}           err, x;}
\DoxyCodeLine{444    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[32];}
\DoxyCodeLine{445 }
\DoxyCodeLine{446    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(prng != NULL);}
\DoxyCodeLine{447 }
\DoxyCodeLine{448    \mbox{\hyperlink{tomcrypt__custom_8h_a427a107414e4d775fbf23f4a499f4a31}{LTC\_MUTEX\_LOCK}}(\&prng->lock);}
\DoxyCodeLine{449    prng->\mbox{\hyperlink{structprng__state_ad5b2704260668ba49701ba0169286837}{ready}} = 0;}
\DoxyCodeLine{450 }
\DoxyCodeLine{451    \textcolor{comment}{/* terminate all the hashes */}}
\DoxyCodeLine{452    \textcolor{keywordflow}{for} (x = 0; x < \mbox{\hyperlink{tomcrypt__custom_8h_aa38cc64a9bea21aba17c1936b453f77b}{LTC\_FORTUNA\_POOLS}}; x++) \{}
\DoxyCodeLine{453        \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{sha256_8c_a53db56f3eb9f35c59b134533be31c301}{sha256\_done}}(\&(prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool[x]), tmp)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{454           \textcolor{keywordflow}{goto} LBL\_UNLOCK;}
\DoxyCodeLine{455        \}}
\DoxyCodeLine{456    \}}
\DoxyCodeLine{457    \textcolor{comment}{/* call cipher done when we invent one ;-) */}}
\DoxyCodeLine{458    err = \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}; \textcolor{comment}{/* success */}}
\DoxyCodeLine{459 }
\DoxyCodeLine{460 LBL\_UNLOCK:}
\DoxyCodeLine{461 \textcolor{preprocessor}{\#ifdef LTC\_CLEAN\_STACK}}
\DoxyCodeLine{462    \mbox{\hyperlink{tomcrypt__misc_8h_a63b6e188713790263bfd3612fe8b398f}{zeromem}}(tmp, \textcolor{keyword}{sizeof}(tmp));}
\DoxyCodeLine{463 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{464    \mbox{\hyperlink{tomcrypt__custom_8h_acdf267be91b178b4fafe8f992d57a7f1}{LTC\_MUTEX\_UNLOCK}}(\&prng->lock);}
\DoxyCodeLine{465    \mbox{\hyperlink{tomcrypt__custom_8h_ae3979e1469d64fe3e864c9effca73724}{LTC\_MUTEX\_DESTROY}}(\&prng->lock);}
\DoxyCodeLine{466    \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{467 \}}

\end{DoxyCode}


References C\+R\+Y\+P\+T\+\_\+\+OK, L\+T\+C\+\_\+\+A\+R\+G\+C\+HK, L\+T\+C\+\_\+\+F\+O\+R\+T\+U\+N\+A\+\_\+\+P\+O\+O\+LS, L\+T\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+\+D\+E\+S\+T\+R\+OY, L\+T\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+\+L\+O\+CK, L\+T\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+\+U\+N\+L\+O\+CK, prng\+\_\+state\+::ready, sha256\+\_\+done(), prng\+\_\+state\+::u, and zeromem().

Here is the call graph for this function\+:
% FIG 8
\mbox{\Hypertarget{fortuna_8c_a6e655bf4b2449fc071e55c8b2ed39ae4}\label{fortuna_8c_a6e655bf4b2449fc071e55c8b2ed39ae4}} 
\index{fortuna.c@{fortuna.c}!fortuna\_export@{fortuna\_export}}
\index{fortuna\_export@{fortuna\_export}!fortuna.c@{fortuna.c}}
\subsubsection{\texorpdfstring{fortuna\_export()}{fortuna\_export()}}
{\footnotesize\ttfamily int fortuna\+\_\+export (\begin{DoxyParamCaption}\item[{unsigned char $\ast$}]{out,  }\item[{unsigned long $\ast$}]{outlen,  }\item[{\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$}]{prng }\end{DoxyParamCaption})}



Export the P\+R\+NG state. 


\begin{DoxyParams}{Parameters}
{\em out} & \mbox{[}out\mbox{]} Destination \\
\hline
{\em outlen} & \mbox{[}in/out\mbox{]} Max size and resulting size of the state \\
\hline
{\em prng} & The P\+R\+NG to export \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
C\+R\+Y\+P\+T\+\_\+\+OK if successful 
\end{DoxyReturn}


Definition at line 476 of file fortuna.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{486 \{}

\end{DoxyCode}
\mbox{\Hypertarget{fortuna_8c_ad9f529aaecf6646cac5e5eaa2d1f418d}\label{fortuna_8c_ad9f529aaecf6646cac5e5eaa2d1f418d}} 
\index{fortuna.c@{fortuna.c}!fortuna\_import@{fortuna\_import}}
\index{fortuna\_import@{fortuna\_import}!fortuna.c@{fortuna.c}}
\subsubsection{\texorpdfstring{fortuna\_import()}{fortuna\_import()}}
{\footnotesize\ttfamily int fortuna\+\_\+import (\begin{DoxyParamCaption}\item[{const unsigned char $\ast$}]{in,  }\item[{unsigned long}]{inlen,  }\item[{\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$}]{prng }\end{DoxyParamCaption})}



Import a P\+R\+NG state. 


\begin{DoxyParams}{Parameters}
{\em in} & The P\+R\+NG state \\
\hline
{\em inlen} & Size of the state \\
\hline
{\em prng} & The P\+R\+NG to import \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
C\+R\+Y\+P\+T\+\_\+\+OK if successful 
\end{DoxyReturn}


Definition at line 485 of file fortuna.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{486 \{}
\DoxyCodeLine{487    \textcolor{keywordtype}{int}           err;}
\DoxyCodeLine{488 }
\DoxyCodeLine{489    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(in    != NULL);}
\DoxyCodeLine{490    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(prng  != NULL);}
\DoxyCodeLine{491 }
\DoxyCodeLine{492    \textcolor{keywordflow}{if} (inlen < (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})\mbox{\hyperlink{fortuna_8c_a58d667818369213be05a67ff635ebb78}{fortuna\_desc}}.\mbox{\hyperlink{structltc__prng__descriptor_a41ef184ab75b213366392faabcde420c}{export\_size}}) \{}
\DoxyCodeLine{493       \textcolor{keywordflow}{return} \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06ca92aa8bad3930f08d5a188bf72094b066}{CRYPT\_INVALID\_ARG}};}
\DoxyCodeLine{494    \}}
\DoxyCodeLine{495 }
\DoxyCodeLine{496    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{fortuna_8c_a54822f5e172e6f2a025448f6e9430e22}{fortuna\_start}}(prng)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{497       \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{498    \}}
\DoxyCodeLine{499 }
\DoxyCodeLine{500    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{fortuna_8c_a8a0df3516c28ad940932db01cfa194f9}{fortuna\_update\_seed}}(in, inlen, prng)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{501       \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{502    \}}
\DoxyCodeLine{503 }
\DoxyCodeLine{504    \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{505 \}}

\end{DoxyCode}


References C\+R\+Y\+P\+T\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+A\+RG, C\+R\+Y\+P\+T\+\_\+\+OK, ltc\+\_\+prng\+\_\+descriptor\+::export\+\_\+size, fortuna\+\_\+desc, fortuna\+\_\+start(), fortuna\+\_\+update\+\_\+seed(), and L\+T\+C\+\_\+\+A\+R\+G\+C\+HK.

Here is the call graph for this function\+:
% FIG 9
\mbox{\Hypertarget{fortuna_8c_a19149fcfc926ab81d4acebfcf39b78f7}\label{fortuna_8c_a19149fcfc926ab81d4acebfcf39b78f7}} 
\index{fortuna.c@{fortuna.c}!fortuna\_read@{fortuna\_read}}
\index{fortuna\_read@{fortuna\_read}!fortuna.c@{fortuna.c}}
\subsubsection{\texorpdfstring{fortuna\_read()}{fortuna\_read()}}
{\footnotesize\ttfamily unsigned long fortuna\+\_\+read (\begin{DoxyParamCaption}\item[{unsigned char $\ast$}]{out,  }\item[{unsigned long}]{outlen,  }\item[{\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$}]{prng }\end{DoxyParamCaption})}



Read from the P\+R\+NG. 


\begin{DoxyParams}{Parameters}
{\em out} & Destination \\
\hline
{\em outlen} & Length of output \\
\hline
{\em prng} & The active P\+R\+NG to read from \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Number of octets read 
\end{DoxyReturn}


Definition at line 373 of file fortuna.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{374 \{}
\DoxyCodeLine{375    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[16];}
\DoxyCodeLine{376    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} tlen = 0;}
\DoxyCodeLine{377 }
\DoxyCodeLine{378    \textcolor{keywordflow}{if} (outlen == 0 || prng == NULL || out == NULL) \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{379 }
\DoxyCodeLine{380    \mbox{\hyperlink{tomcrypt__custom_8h_a427a107414e4d775fbf23f4a499f4a31}{LTC\_MUTEX\_LOCK}}(\&prng->lock);}
\DoxyCodeLine{381 }
\DoxyCodeLine{382    \textcolor{keywordflow}{if} (!prng->\mbox{\hyperlink{structprng__state_ad5b2704260668ba49701ba0169286837}{ready}}) \{}
\DoxyCodeLine{383       \textcolor{keywordflow}{goto} LBL\_UNLOCK;}
\DoxyCodeLine{384    \}}
\DoxyCodeLine{385 }
\DoxyCodeLine{386    \textcolor{comment}{/* do we have to reseed? */}}
\DoxyCodeLine{387    \textcolor{keywordflow}{if} (prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool0\_len >= 64) \{}
\DoxyCodeLine{388       \textcolor{keywordflow}{if} (\mbox{\hyperlink{fortuna_8c_aad833baa2e75f93d847e5a7ac30ea4d2}{\_fortuna\_reseed}}(prng) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{389          \textcolor{keywordflow}{goto} LBL\_UNLOCK;}
\DoxyCodeLine{390       \}}
\DoxyCodeLine{391    \}}
\DoxyCodeLine{392 }
\DoxyCodeLine{393    \textcolor{comment}{/* ensure that one reseed happened before allowing to read */}}
\DoxyCodeLine{394    \textcolor{keywordflow}{if} (prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.reset\_cnt == 0) \{}
\DoxyCodeLine{395       \textcolor{keywordflow}{goto} LBL\_UNLOCK;}
\DoxyCodeLine{396    \}}
\DoxyCodeLine{397 }
\DoxyCodeLine{398    \textcolor{comment}{/* now generate the blocks required */}}
\DoxyCodeLine{399    tlen = outlen;}
\DoxyCodeLine{400 }
\DoxyCodeLine{401    \textcolor{comment}{/* handle whole blocks without the extra XMEMCPY */}}
\DoxyCodeLine{402    \textcolor{keywordflow}{while} (outlen >= 16) \{}
\DoxyCodeLine{403       \textcolor{comment}{/* encrypt the IV and store it */}}
\DoxyCodeLine{404       \mbox{\hyperlink{aes_8c_acd7dbcdfa46b39fa19932a0658676047}{rijndael\_ecb\_encrypt}}(prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.IV, out, \&prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.skey);}
\DoxyCodeLine{405       out += 16;}
\DoxyCodeLine{406       outlen -= 16;}
\DoxyCodeLine{407       \mbox{\hyperlink{fortuna_8c_a5e5b2b7f0a18fae044e2f53384a51c6b}{\_fortuna\_update\_iv}}(prng);}
\DoxyCodeLine{408    \}}
\DoxyCodeLine{409 }
\DoxyCodeLine{410    \textcolor{comment}{/* left over bytes? */}}
\DoxyCodeLine{411    \textcolor{keywordflow}{if} (outlen > 0) \{}
\DoxyCodeLine{412       \mbox{\hyperlink{aes_8c_acd7dbcdfa46b39fa19932a0658676047}{rijndael\_ecb\_encrypt}}(prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.IV, tmp, \&prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.skey);}
\DoxyCodeLine{413       \mbox{\hyperlink{tomcrypt__cfg_8h_a7691dd48d60d5fc6daf2fa7ec4c55e12}{XMEMCPY}}(out, tmp, outlen);}
\DoxyCodeLine{414       \mbox{\hyperlink{fortuna_8c_a5e5b2b7f0a18fae044e2f53384a51c6b}{\_fortuna\_update\_iv}}(prng);}
\DoxyCodeLine{415    \}}
\DoxyCodeLine{416 }
\DoxyCodeLine{417    \textcolor{comment}{/* generate new key */}}
\DoxyCodeLine{418    \mbox{\hyperlink{aes_8c_acd7dbcdfa46b39fa19932a0658676047}{rijndael\_ecb\_encrypt}}(prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.IV, prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.K   , \&prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.skey);}
\DoxyCodeLine{419    \mbox{\hyperlink{fortuna_8c_a5e5b2b7f0a18fae044e2f53384a51c6b}{\_fortuna\_update\_iv}}(prng);}
\DoxyCodeLine{420 }
\DoxyCodeLine{421    \mbox{\hyperlink{aes_8c_acd7dbcdfa46b39fa19932a0658676047}{rijndael\_ecb\_encrypt}}(prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.IV, prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.K+16, \&prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.skey);}
\DoxyCodeLine{422    \mbox{\hyperlink{fortuna_8c_a5e5b2b7f0a18fae044e2f53384a51c6b}{\_fortuna\_update\_iv}}(prng);}
\DoxyCodeLine{423 }
\DoxyCodeLine{424    \textcolor{keywordflow}{if} (\mbox{\hyperlink{aes_8c_a3b2fab908c22514c91332a5c9a3d7166}{rijndael\_setup}}(prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.K, 32, 0, \&prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.skey) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{425       tlen = 0;}
\DoxyCodeLine{426    \}}
\DoxyCodeLine{427 }
\DoxyCodeLine{428 LBL\_UNLOCK:}
\DoxyCodeLine{429 \textcolor{preprocessor}{\#ifdef LTC\_CLEAN\_STACK}}
\DoxyCodeLine{430    \mbox{\hyperlink{tomcrypt__misc_8h_a63b6e188713790263bfd3612fe8b398f}{zeromem}}(tmp, \textcolor{keyword}{sizeof}(tmp));}
\DoxyCodeLine{431 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{432    \mbox{\hyperlink{tomcrypt__custom_8h_acdf267be91b178b4fafe8f992d57a7f1}{LTC\_MUTEX\_UNLOCK}}(\&prng->lock);}
\DoxyCodeLine{433    \textcolor{keywordflow}{return} tlen;}
\DoxyCodeLine{434 \}}

\end{DoxyCode}


References \+\_\+fortuna\+\_\+reseed(), \+\_\+fortuna\+\_\+update\+\_\+iv(), C\+R\+Y\+P\+T\+\_\+\+OK, L\+T\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+\+L\+O\+CK, L\+T\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+\+U\+N\+L\+O\+CK, prng\+\_\+state\+::ready, rijndael\+\_\+ecb\+\_\+encrypt(), rijndael\+\_\+setup(), prng\+\_\+state\+::u, X\+M\+E\+M\+C\+P\+Y(), and zeromem().

Here is the call graph for this function\+:
% FIG 10
\mbox{\Hypertarget{fortuna_8c_a635d034d99b51a38b4a71fae3880b48f}\label{fortuna_8c_a635d034d99b51a38b4a71fae3880b48f}} 
\index{fortuna.c@{fortuna.c}!fortuna\_ready@{fortuna\_ready}}
\index{fortuna\_ready@{fortuna\_ready}!fortuna.c@{fortuna.c}}
\subsubsection{\texorpdfstring{fortuna\_ready()}{fortuna\_ready()}}
{\footnotesize\ttfamily int fortuna\+\_\+ready (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$}]{prng }\end{DoxyParamCaption})}



Make the P\+R\+NG ready to read from. 


\begin{DoxyParams}{Parameters}
{\em prng} & The P\+R\+NG to make active \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
C\+R\+Y\+P\+T\+\_\+\+OK if successful 
\end{DoxyReturn}


Definition at line 346 of file fortuna.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{347 \{}
\DoxyCodeLine{348    \textcolor{keywordtype}{int} err;}
\DoxyCodeLine{349    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(prng != NULL);}
\DoxyCodeLine{350 }
\DoxyCodeLine{351    \mbox{\hyperlink{tomcrypt__custom_8h_a427a107414e4d775fbf23f4a499f4a31}{LTC\_MUTEX\_LOCK}}(\&prng->lock);}
\DoxyCodeLine{352    \textcolor{comment}{/* make sure the reseed doesn't fail because}}
\DoxyCodeLine{353 \textcolor{comment}{    * of the chosen rate limit */}}
\DoxyCodeLine{354 \textcolor{preprocessor}{\#ifdef LTC\_FORTUNA\_RESEED\_RATELIMIT\_TIMED}}
\DoxyCodeLine{355    prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.wd = \_fortuna\_current\_time() - 1;}
\DoxyCodeLine{356 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{357    prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.wd = \mbox{\hyperlink{tomcrypt__custom_8h_af58a920e681cb68756017d8364e4a692}{LTC\_FORTUNA\_WD}};}
\DoxyCodeLine{358 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{359    err = \mbox{\hyperlink{fortuna_8c_aad833baa2e75f93d847e5a7ac30ea4d2}{\_fortuna\_reseed}}(prng);}
\DoxyCodeLine{360    prng->\mbox{\hyperlink{structprng__state_ad5b2704260668ba49701ba0169286837}{ready}} = (err == \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) ? 1 : 0;}
\DoxyCodeLine{361 }
\DoxyCodeLine{362    \mbox{\hyperlink{tomcrypt__custom_8h_acdf267be91b178b4fafe8f992d57a7f1}{LTC\_MUTEX\_UNLOCK}}(\&prng->lock);}
\DoxyCodeLine{363    \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{364 \}}

\end{DoxyCode}


References \+\_\+fortuna\+\_\+reseed(), C\+R\+Y\+P\+T\+\_\+\+OK, L\+T\+C\+\_\+\+A\+R\+G\+C\+HK, L\+T\+C\+\_\+\+F\+O\+R\+T\+U\+N\+A\+\_\+\+WD, L\+T\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+\+L\+O\+CK, L\+T\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+\+U\+N\+L\+O\+CK, prng\+\_\+state\+::ready, and prng\+\_\+state\+::u.

Here is the call graph for this function\+:
% FIG 11
\mbox{\Hypertarget{fortuna_8c_a54822f5e172e6f2a025448f6e9430e22}\label{fortuna_8c_a54822f5e172e6f2a025448f6e9430e22}} 
\index{fortuna.c@{fortuna.c}!fortuna\_start@{fortuna\_start}}
\index{fortuna\_start@{fortuna\_start}!fortuna.c@{fortuna.c}}
\subsubsection{\texorpdfstring{fortuna\_start()}{fortuna\_start()}}
{\footnotesize\ttfamily int fortuna\+\_\+start (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$}]{prng }\end{DoxyParamCaption})}



Start the P\+R\+NG. 


\begin{DoxyParams}{Parameters}
{\em prng} & \mbox{[}out\mbox{]} The P\+R\+NG state to initialize \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
C\+R\+Y\+P\+T\+\_\+\+OK if successful 
\end{DoxyReturn}


Definition at line 223 of file fortuna.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{224 \{}
\DoxyCodeLine{225    \textcolor{keywordtype}{int} err, x, y;}
\DoxyCodeLine{226    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[\mbox{\hyperlink{tomcrypt_8h_ab59933beebb2b857c992b93cf53f0d10}{MAXBLOCKSIZE}}];}
\DoxyCodeLine{227 }
\DoxyCodeLine{228    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(prng != NULL);}
\DoxyCodeLine{229    prng->\mbox{\hyperlink{structprng__state_ad5b2704260668ba49701ba0169286837}{ready}} = 0;}
\DoxyCodeLine{230 }
\DoxyCodeLine{231    \textcolor{comment}{/* initialize the pools */}}
\DoxyCodeLine{232    \textcolor{keywordflow}{for} (x = 0; x < \mbox{\hyperlink{tomcrypt__custom_8h_aa38cc64a9bea21aba17c1936b453f77b}{LTC\_FORTUNA\_POOLS}}; x++) \{}
\DoxyCodeLine{233        \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{sha256_8c_a6290ad544b02c822c2ca6c30b8d1ee07}{sha256\_init}}(\&prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool[x])) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{234           \textcolor{keywordflow}{for} (y = 0; y < x; y++) \{}
\DoxyCodeLine{235               \mbox{\hyperlink{sha256_8c_a53db56f3eb9f35c59b134533be31c301}{sha256\_done}}(\&prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool[y], tmp);}
\DoxyCodeLine{236           \}}
\DoxyCodeLine{237           \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{238        \}}
\DoxyCodeLine{239    \}}
\DoxyCodeLine{240    prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool\_idx = prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool0\_len = prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.wd = 0;}
\DoxyCodeLine{241    prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.reset\_cnt = 0;}
\DoxyCodeLine{242 }
\DoxyCodeLine{243    \textcolor{comment}{/* reset bufs */}}
\DoxyCodeLine{244    \mbox{\hyperlink{tomcrypt__misc_8h_a63b6e188713790263bfd3612fe8b398f}{zeromem}}(prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.K, 32);}
\DoxyCodeLine{245    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{aes_8c_a3b2fab908c22514c91332a5c9a3d7166}{rijndael\_setup}}(prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.K, 32, 0, \&prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.skey)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{246       \textcolor{keywordflow}{for} (x = 0; x < \mbox{\hyperlink{tomcrypt__custom_8h_aa38cc64a9bea21aba17c1936b453f77b}{LTC\_FORTUNA\_POOLS}}; x++) \{}
\DoxyCodeLine{247           \mbox{\hyperlink{sha256_8c_a53db56f3eb9f35c59b134533be31c301}{sha256\_done}}(\&prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.pool[x], tmp);}
\DoxyCodeLine{248       \}}
\DoxyCodeLine{249       \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{250    \}}
\DoxyCodeLine{251    \mbox{\hyperlink{tomcrypt__misc_8h_a63b6e188713790263bfd3612fe8b398f}{zeromem}}(prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.IV, 16);}
\DoxyCodeLine{252 }
\DoxyCodeLine{253    \mbox{\hyperlink{tomcrypt__custom_8h_a450b04a6e1d004908791edaa0901d284}{LTC\_MUTEX\_INIT}}(\&prng->lock)}
\DoxyCodeLine{254 }
\DoxyCodeLine{255    return \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}};}
\DoxyCodeLine{256 \}}

\end{DoxyCode}


References C\+R\+Y\+P\+T\+\_\+\+OK, L\+T\+C\+\_\+\+A\+R\+G\+C\+HK, L\+T\+C\+\_\+\+F\+O\+R\+T\+U\+N\+A\+\_\+\+P\+O\+O\+LS, L\+T\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+\+I\+N\+IT, M\+A\+X\+B\+L\+O\+C\+K\+S\+I\+ZE, prng\+\_\+state\+::ready, rijndael\+\_\+setup(), sha256\+\_\+done(), sha256\+\_\+init(), prng\+\_\+state\+::u, and zeromem().



Referenced by fortuna\+\_\+import().

Here is the call graph for this function\+:
% FIG 12
Here is the caller graph for this function\+:
% FIG 13
\mbox{\Hypertarget{fortuna_8c_a02a8621eda36a40059ce155007b6f6c3}\label{fortuna_8c_a02a8621eda36a40059ce155007b6f6c3}} 
\index{fortuna.c@{fortuna.c}!fortuna\_test@{fortuna\_test}}
\index{fortuna\_test@{fortuna\_test}!fortuna.c@{fortuna.c}}
\subsubsection{\texorpdfstring{fortuna\_test()}{fortuna\_test()}}
{\footnotesize\ttfamily int fortuna\+\_\+test (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



P\+R\+NG self-\/test. 

\begin{DoxyReturn}{Returns}
C\+R\+Y\+P\+T\+\_\+\+OK if successful, C\+R\+Y\+P\+T\+\_\+\+N\+OP if self-\/testing has been disabled 
\end{DoxyReturn}


Definition at line 511 of file fortuna.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{512 \{}
\DoxyCodeLine{513 \textcolor{preprocessor}{\#ifndef LTC\_TEST}}
\DoxyCodeLine{514    \textcolor{keywordflow}{return} \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cac43a7799c7fd5f515172da6cfc0f9cf5}{CRYPT\_NOP}};}
\DoxyCodeLine{515 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{516    \textcolor{keywordtype}{int} err;}
\DoxyCodeLine{517 }
\DoxyCodeLine{518    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{sha256_8c_a3a9304ee8cdb3aaa8fc90f0b70592e7b}{sha256\_test}}()) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{519       \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{520    \}}
\DoxyCodeLine{521    \textcolor{keywordflow}{return} \mbox{\hyperlink{aes_8c_a787877f61031ca3855283ee7755f1b46}{rijndael\_test}}();}
\DoxyCodeLine{522 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{523 \}}

\end{DoxyCode}


References C\+R\+Y\+P\+T\+\_\+\+N\+OP, C\+R\+Y\+P\+T\+\_\+\+OK, rijndael\+\_\+test(), and sha256\+\_\+test().

Here is the call graph for this function\+:
% FIG 14
\mbox{\Hypertarget{fortuna_8c_a8a0df3516c28ad940932db01cfa194f9}\label{fortuna_8c_a8a0df3516c28ad940932db01cfa194f9}} 
\index{fortuna.c@{fortuna.c}!fortuna\_update\_seed@{fortuna\_update\_seed}}
\index{fortuna\_update\_seed@{fortuna\_update\_seed}!fortuna.c@{fortuna.c}}
\subsubsection{\texorpdfstring{fortuna\_update\_seed()}{fortuna\_update\_seed()}}
{\footnotesize\ttfamily int fortuna\+\_\+update\+\_\+seed (\begin{DoxyParamCaption}\item[{const unsigned char $\ast$}]{in,  }\item[{unsigned long}]{inlen,  }\item[{\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$}]{prng }\end{DoxyParamCaption})}



\char`\"{}\+Update Seed File\char`\"{}-\/compliant update of K 


\begin{DoxyParams}{Parameters}
{\em in} & The P\+R\+NG state \\
\hline
{\em inlen} & Size of the state \\
\hline
{\em prng} & The P\+R\+NG to import \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
C\+R\+Y\+P\+T\+\_\+\+OK if successful 
\end{DoxyReturn}


Definition at line 186 of file fortuna.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{187 \{}
\DoxyCodeLine{188    \textcolor{keywordtype}{int}           err;}
\DoxyCodeLine{189    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} tmp[\mbox{\hyperlink{tomcrypt_8h_ab59933beebb2b857c992b93cf53f0d10}{MAXBLOCKSIZE}}];}
\DoxyCodeLine{190    \mbox{\hyperlink{unionHash__state}{hash\_state}}    md;}
\DoxyCodeLine{191 }
\DoxyCodeLine{192    \mbox{\hyperlink{tomcrypt__custom_8h_a427a107414e4d775fbf23f4a499f4a31}{LTC\_MUTEX\_LOCK}}(\&prng->lock);}
\DoxyCodeLine{193    \textcolor{comment}{/* new K = LTC\_SHA256(K || in) */}}
\DoxyCodeLine{194    \mbox{\hyperlink{sha256_8c_a6290ad544b02c822c2ca6c30b8d1ee07}{sha256\_init}}(\&md);}
\DoxyCodeLine{195    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{sha256_8c_a8b983a80c9edd5d997a3937963ae7856}{sha256\_process}}(\&md, prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.K, 32)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{196       \mbox{\hyperlink{sha256_8c_a53db56f3eb9f35c59b134533be31c301}{sha256\_done}}(\&md, tmp);}
\DoxyCodeLine{197       \textcolor{keywordflow}{goto} LBL\_UNLOCK;}
\DoxyCodeLine{198    \}}
\DoxyCodeLine{199    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{sha256_8c_a8b983a80c9edd5d997a3937963ae7856}{sha256\_process}}(\&md, in, inlen)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{200       \mbox{\hyperlink{sha256_8c_a53db56f3eb9f35c59b134533be31c301}{sha256\_done}}(\&md, tmp);}
\DoxyCodeLine{201       \textcolor{keywordflow}{goto} LBL\_UNLOCK;}
\DoxyCodeLine{202    \}}
\DoxyCodeLine{203    \textcolor{comment}{/* finish key */}}
\DoxyCodeLine{204    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{sha256_8c_a53db56f3eb9f35c59b134533be31c301}{sha256\_done}}(\&md, prng->\mbox{\hyperlink{structprng__state_a73ffeba26752871bc883f035a89f0991}{u}}.fortuna.K)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{205       \textcolor{keywordflow}{goto} LBL\_UNLOCK;}
\DoxyCodeLine{206    \}}
\DoxyCodeLine{207    \mbox{\hyperlink{fortuna_8c_a5e5b2b7f0a18fae044e2f53384a51c6b}{\_fortuna\_update\_iv}}(prng);}
\DoxyCodeLine{208 }
\DoxyCodeLine{209 LBL\_UNLOCK:}
\DoxyCodeLine{210    \mbox{\hyperlink{tomcrypt__custom_8h_acdf267be91b178b4fafe8f992d57a7f1}{LTC\_MUTEX\_UNLOCK}}(\&prng->lock);}
\DoxyCodeLine{211 \textcolor{preprocessor}{\#ifdef LTC\_CLEAN\_STACK}}
\DoxyCodeLine{212    \mbox{\hyperlink{tomcrypt__misc_8h_a63b6e188713790263bfd3612fe8b398f}{zeromem}}(\&md, \textcolor{keyword}{sizeof}(md));}
\DoxyCodeLine{213 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{214 }
\DoxyCodeLine{215    \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{216 \}}

\end{DoxyCode}


References \+\_\+fortuna\+\_\+update\+\_\+iv(), C\+R\+Y\+P\+T\+\_\+\+OK, L\+T\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+\+L\+O\+CK, L\+T\+C\+\_\+\+M\+U\+T\+E\+X\+\_\+\+U\+N\+L\+O\+CK, M\+A\+X\+B\+L\+O\+C\+K\+S\+I\+ZE, sha256\+\_\+done(), sha256\+\_\+init(), sha256\+\_\+process(), prng\+\_\+state\+::u, and zeromem().



Referenced by fortuna\+\_\+import().

Here is the call graph for this function\+:
% FIG 15
Here is the caller graph for this function\+:
% FIG 16


\subsection{Variable Documentation}
\mbox{\Hypertarget{fortuna_8c_a58d667818369213be05a67ff635ebb78}\label{fortuna_8c_a58d667818369213be05a67ff635ebb78}} 
\index{fortuna.c@{fortuna.c}!fortuna\_desc@{fortuna\_desc}}
\index{fortuna\_desc@{fortuna\_desc}!fortuna.c@{fortuna.c}}
\subsubsection{\texorpdfstring{fortuna\_desc}{fortuna\_desc}}
{\footnotesize\ttfamily const struct \mbox{\hyperlink{structltc__prng__descriptor}{ltc\+\_\+prng\+\_\+descriptor}} fortuna\+\_\+desc}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{= \{}
\DoxyCodeLine{    \textcolor{stringliteral}{"fortuna"},}
\DoxyCodeLine{    64,}
\DoxyCodeLine{    \&\mbox{\hyperlink{fortuna_8c_a54822f5e172e6f2a025448f6e9430e22}{fortuna\_start}},}
\DoxyCodeLine{    \&\mbox{\hyperlink{fortuna_8c_ad94b1b4f59e40bd1409a4f2dc46065c3}{fortuna\_add\_entropy}},}
\DoxyCodeLine{    \&\mbox{\hyperlink{fortuna_8c_a635d034d99b51a38b4a71fae3880b48f}{fortuna\_ready}},}
\DoxyCodeLine{    \&\mbox{\hyperlink{fortuna_8c_a19149fcfc926ab81d4acebfcf39b78f7}{fortuna\_read}},}
\DoxyCodeLine{    \&\mbox{\hyperlink{fortuna_8c_ab875173ff3316ba29598b7fb3b03f186}{fortuna\_done}},}
\DoxyCodeLine{    \&\mbox{\hyperlink{fortuna_8c_a6e655bf4b2449fc071e55c8b2ed39ae4}{fortuna\_export}},}
\DoxyCodeLine{    \&\mbox{\hyperlink{fortuna_8c_ad9f529aaecf6646cac5e5eaa2d1f418d}{fortuna\_import}},}
\DoxyCodeLine{    \&\mbox{\hyperlink{fortuna_8c_a02a8621eda36a40059ce155007b6f6c3}{fortuna\_test}}}
\DoxyCodeLine{\}}

\end{DoxyCode}


Definition at line 48 of file fortuna.\+c.



Referenced by fortuna\+\_\+import(), and register\+\_\+all\+\_\+prngs().

