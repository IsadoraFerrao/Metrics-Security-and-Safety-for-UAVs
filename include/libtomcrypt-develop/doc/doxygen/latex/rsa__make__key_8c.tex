\hypertarget{rsa__make__key_8c}{}\section{M\+:/\+Office/!\+Doutorado/0. Repositorio\+S\+V\+N/\+H\+A\+M\+S\+T\+E\+R\+\_\+\+Prototype/branches/\+J\+I\+N\+T2018/include/libtomcrypt-\/develop/src/pk/rsa/rsa\+\_\+make\+\_\+key.c File Reference}
\label{rsa__make__key_8c}\index{M:/Office/"!Doutorado/0. RepositorioSVN/HAMSTER\_Prototype/branches/JINT2018/include/libtomcrypt-\/develop/src/pk/rsa/rsa\_make\_key.c@{M:/Office/"!Doutorado/0. RepositorioSVN/HAMSTER\_Prototype/branches/JINT2018/include/libtomcrypt-\/develop/src/pk/rsa/rsa\_make\_key.c}}


R\+SA key generation, Tom St Denis.  


{\ttfamily \#include \char`\"{}tomcrypt\+\_\+private.\+h\char`\"{}}\newline
Include dependency graph for rsa\+\_\+make\+\_\+key.\+c\+:
% FIG 0
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{rsa__make__key_8c_aece58b13922a56a3fbcce677333dad9a}{rsa\+\_\+make\+\_\+key}} (\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$prng, int wprng, int size, long e, \mbox{\hyperlink{tomcrypt__math_8h_a99eca413acdcc914993162bd18cba437}{rsa\+\_\+key}} $\ast$key)
\begin{DoxyCompactList}\small\item\em Create an R\+SA key. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
R\+SA key generation, Tom St Denis. 



\subsection{Function Documentation}
\mbox{\Hypertarget{rsa__make__key_8c_aece58b13922a56a3fbcce677333dad9a}\label{rsa__make__key_8c_aece58b13922a56a3fbcce677333dad9a}} 
\index{rsa\_make\_key.c@{rsa\_make\_key.c}!rsa\_make\_key@{rsa\_make\_key}}
\index{rsa\_make\_key@{rsa\_make\_key}!rsa\_make\_key.c@{rsa\_make\_key.c}}
\subsubsection{\texorpdfstring{rsa\_make\_key()}{rsa\_make\_key()}}
{\footnotesize\ttfamily int rsa\+\_\+make\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structprng__state}{prng\+\_\+state}} $\ast$}]{prng,  }\item[{int}]{wprng,  }\item[{int}]{size,  }\item[{long}]{e,  }\item[{\mbox{\hyperlink{tomcrypt__math_8h_a99eca413acdcc914993162bd18cba437}{rsa\+\_\+key}} $\ast$}]{key }\end{DoxyParamCaption})}



Create an R\+SA key. 


\begin{DoxyParams}{Parameters}
{\em prng} & An active P\+R\+NG state \\
\hline
{\em wprng} & The index of the P\+R\+NG desired \\
\hline
{\em size} & The size of the modulus (key size) desired (octets) \\
\hline
{\em e} & The \char`\"{}e\char`\"{} value (public key). e==65537 is a good choice \\
\hline
{\em key} & \mbox{[}out\mbox{]} Destination of a newly created private key pair \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
C\+R\+Y\+P\+T\+\_\+\+OK if successful, upon error all allocated ram is freed 
\end{DoxyReturn}


Definition at line 27 of file rsa\+\_\+make\+\_\+key.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{28 \{}
\DoxyCodeLine{29    \textcolor{keywordtype}{void} *p, *q, *tmp1, *tmp2, *tmp3;}
\DoxyCodeLine{30    \textcolor{keywordtype}{int}    err;}
\DoxyCodeLine{31 }
\DoxyCodeLine{32    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(\mbox{\hyperlink{tomcrypt__math_8h_a3d38c44518c63b7a8abd0938f3d41c65}{ltc\_mp}}.\mbox{\hyperlink{structltc__math__descriptor_a8838126de4a27e382f91096e369a2728}{name}} != NULL);}
\DoxyCodeLine{33    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(key         != NULL);}
\DoxyCodeLine{34    \mbox{\hyperlink{tomcrypt__argchk_8h_a683da3e041e49f196318b6ea951414ba}{LTC\_ARGCHK}}(\mbox{\hyperlink{structedge_a64bdc14a16193c014f1ef50be358441d}{size}}        > 0);}
\DoxyCodeLine{35 }
\DoxyCodeLine{36    \textcolor{keywordflow}{if} ((e < 3) || ((e \& 1) == 0)) \{}
\DoxyCodeLine{37       \textcolor{keywordflow}{return} \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06ca92aa8bad3930f08d5a188bf72094b066}{CRYPT\_INVALID\_ARG}};}
\DoxyCodeLine{38    \}}
\DoxyCodeLine{39 }
\DoxyCodeLine{40    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__prng_8h_a7e4a212c1a29a3b8bb4f8d5a34676a1e}{prng\_is\_valid}}(wprng)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{41       \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{42    \}}
\DoxyCodeLine{43 }
\DoxyCodeLine{44    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_adb6322247b1a4f0347219acab3120bd3}{mp\_init\_multi}}(\&p, \&q, \&tmp1, \&tmp2, \&tmp3, NULL)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{45       \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{46    \}}
\DoxyCodeLine{47 }
\DoxyCodeLine{48    \textcolor{comment}{/* make primes p and q (optimization provided by Wayne Scott) */}}
\DoxyCodeLine{49    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_ab06bc6503c4faab10b7ce60bef365d65}{mp\_set\_int}}(tmp3, e)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})                      \{ \textcolor{keywordflow}{goto} cleanup; \}  \textcolor{comment}{/* tmp3 = e */}}
\DoxyCodeLine{50 }
\DoxyCodeLine{51    \textcolor{comment}{/* make prime "p" */}}
\DoxyCodeLine{52    \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{53        \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__pk_8h_a756aed6a613ea5a005bb97a4de155622}{rand\_prime}}( p, \mbox{\hyperlink{structedge_a64bdc14a16193c014f1ef50be358441d}{size}}/2, prng, wprng)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})  \{ \textcolor{keywordflow}{goto} cleanup; \}}
\DoxyCodeLine{54        \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_a4215ff0d6838acb3d959d3e68c923de7}{mp\_sub\_d}}( p, 1,  tmp1)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})               \{ \textcolor{keywordflow}{goto} cleanup; \}  \textcolor{comment}{/* tmp1 = p-1 */}}
\DoxyCodeLine{55        \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_ad9deb5f35c296a1cd7ae37f4e4e210f4}{mp\_gcd}}( tmp1,  tmp3,  tmp2)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})          \{ \textcolor{keywordflow}{goto} cleanup; \}  \textcolor{comment}{/* tmp2 = gcd(p-1, e) */}}
\DoxyCodeLine{56    \} \textcolor{keywordflow}{while} (\mbox{\hyperlink{tomcrypt__private_8h_a6ce44f2e6f872565a468b67d9a93dc28}{mp\_cmp\_d}}( tmp2, 1) != 0);                                                  \textcolor{comment}{/* while e divides p-1 */}}
\DoxyCodeLine{57 }
\DoxyCodeLine{58    \textcolor{comment}{/* make prime "q" */}}
\DoxyCodeLine{59    \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{60        \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__pk_8h_a756aed6a613ea5a005bb97a4de155622}{rand\_prime}}( q, \mbox{\hyperlink{structedge_a64bdc14a16193c014f1ef50be358441d}{size}}/2, prng, wprng)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})  \{ \textcolor{keywordflow}{goto} cleanup; \}}
\DoxyCodeLine{61        \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_a4215ff0d6838acb3d959d3e68c923de7}{mp\_sub\_d}}( q, 1,  tmp1)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})               \{ \textcolor{keywordflow}{goto} cleanup; \} \textcolor{comment}{/* tmp1 = q-1 */}}
\DoxyCodeLine{62        \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_ad9deb5f35c296a1cd7ae37f4e4e210f4}{mp\_gcd}}( tmp1,  tmp3,  tmp2)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})          \{ \textcolor{keywordflow}{goto} cleanup; \} \textcolor{comment}{/* tmp2 = gcd(q-1, e) */}}
\DoxyCodeLine{63    \} \textcolor{keywordflow}{while} (\mbox{\hyperlink{tomcrypt__private_8h_a6ce44f2e6f872565a468b67d9a93dc28}{mp\_cmp\_d}}( tmp2, 1) != 0);                                                 \textcolor{comment}{/* while e divides q-1 */}}
\DoxyCodeLine{64 }
\DoxyCodeLine{65    \textcolor{comment}{/* tmp1 = lcm(p-1, q-1) */}}
\DoxyCodeLine{66    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_a4215ff0d6838acb3d959d3e68c923de7}{mp\_sub\_d}}( p, 1,  tmp2)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})                   \{ \textcolor{keywordflow}{goto} cleanup; \} \textcolor{comment}{/* tmp2 = p-1 */}}
\DoxyCodeLine{67                                                                                       \textcolor{comment}{/* tmp1 = q-1 (previous do/while loop) */}}
\DoxyCodeLine{68    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_a42ca6ad7676c236e06ee8b53e278a1a2}{mp\_lcm}}( tmp1,  tmp2,  tmp1)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})              \{ \textcolor{keywordflow}{goto} cleanup; \} \textcolor{comment}{/* tmp1 = lcm(p-1, q-1) */}}
\DoxyCodeLine{69 }
\DoxyCodeLine{70    \textcolor{comment}{/* make key */}}
\DoxyCodeLine{71    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_adb6322247b1a4f0347219acab3120bd3}{mp\_init\_multi}}(\&key->e, \&key->d, \&key->N, \&key->dQ, \&key->dP, \&key->qP, \&key->p, \&key->q, NULL)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}}) \{}
\DoxyCodeLine{72       \textcolor{keywordflow}{goto} errkey;}
\DoxyCodeLine{73    \}}
\DoxyCodeLine{74 }
\DoxyCodeLine{75    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_ab06bc6503c4faab10b7ce60bef365d65}{mp\_set\_int}}( key->e, e)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})                     \{ \textcolor{keywordflow}{goto} errkey; \} \textcolor{comment}{/* key->e =  e */}}
\DoxyCodeLine{76    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_a8be707236375351ab194f908c8ba9233}{mp\_invmod}}( key->e,  tmp1,  key->d)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})         \{ \textcolor{keywordflow}{goto} errkey; \} \textcolor{comment}{/* key->d = 1/e mod lcm(p-1,q-1) */}}
\DoxyCodeLine{77    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_a7606d2423856b32b09245a2fa1ef34ee}{mp\_mul}}( p,  q,  key->N)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})                    \{ \textcolor{keywordflow}{goto} errkey; \} \textcolor{comment}{/* key->N = pq */}}
\DoxyCodeLine{78 }
\DoxyCodeLine{79    \textcolor{comment}{/* optimize for CRT now */}}
\DoxyCodeLine{80    \textcolor{comment}{/* find d mod q-1 and d mod p-1 */}}
\DoxyCodeLine{81    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_a4215ff0d6838acb3d959d3e68c923de7}{mp\_sub\_d}}( p, 1,  tmp1)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})                     \{ \textcolor{keywordflow}{goto} errkey; \} \textcolor{comment}{/* tmp1 = q-1 */}}
\DoxyCodeLine{82    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_a4215ff0d6838acb3d959d3e68c923de7}{mp\_sub\_d}}( q, 1,  tmp2)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})                     \{ \textcolor{keywordflow}{goto} errkey; \} \textcolor{comment}{/* tmp2 = p-1 */}}
\DoxyCodeLine{83    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_ac7deed6f00e289706070b16f98c430fe}{mp\_mod}}( key->d,  tmp1,  key->dP)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})           \{ \textcolor{keywordflow}{goto} errkey; \} \textcolor{comment}{/* dP = d mod p-1 */}}
\DoxyCodeLine{84    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_ac7deed6f00e289706070b16f98c430fe}{mp\_mod}}( key->d,  tmp2,  key->dQ)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})           \{ \textcolor{keywordflow}{goto} errkey; \} \textcolor{comment}{/* dQ = d mod q-1 */}}
\DoxyCodeLine{85    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_a8be707236375351ab194f908c8ba9233}{mp\_invmod}}( q,  p,  key->qP)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})                \{ \textcolor{keywordflow}{goto} errkey; \} \textcolor{comment}{/* qP = 1/q mod p */}}
\DoxyCodeLine{86 }
\DoxyCodeLine{87    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_afbb35bc8f920448d169ddc83a4308840}{mp\_copy}}( p,  key->p)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})                       \{ \textcolor{keywordflow}{goto} errkey; \}}
\DoxyCodeLine{88    \textcolor{keywordflow}{if} ((err = \mbox{\hyperlink{tomcrypt__private_8h_afbb35bc8f920448d169ddc83a4308840}{mp\_copy}}( q,  key->q)) != \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}})                       \{ \textcolor{keywordflow}{goto} errkey; \}}
\DoxyCodeLine{89 }
\DoxyCodeLine{90    \textcolor{comment}{/* set key type (in this case it's CRT optimized) */}}
\DoxyCodeLine{91    key->type = \mbox{\hyperlink{tomcrypt__pk_8h_afb69d121a43f5ae8b47e6b83611d9272a7295b3dea2c5277912c6e040e1c96649}{PK\_PRIVATE}};}
\DoxyCodeLine{92 }
\DoxyCodeLine{93    \textcolor{comment}{/* return ok and free temps */}}
\DoxyCodeLine{94    err       = \mbox{\hyperlink{tomcrypt_8h_adc29c2ff13d900c2f185ee95427fb06cad0f4c9daf749fe6284266f9384b9e334}{CRYPT\_OK}};}
\DoxyCodeLine{95    \textcolor{keywordflow}{goto} cleanup;}
\DoxyCodeLine{96 errkey:}
\DoxyCodeLine{97    \mbox{\hyperlink{rsa__free_8c_a56f84788895f943be14b89e50c72f911}{rsa\_free}}(key);}
\DoxyCodeLine{98 cleanup:}
\DoxyCodeLine{99    \mbox{\hyperlink{tomcrypt__private_8h_aad5c8a3112b3e4613f9efc86692c43cb}{mp\_clear\_multi}}(tmp3, tmp2, tmp1, q, p, NULL);}
\DoxyCodeLine{100    \textcolor{keywordflow}{return} err;}
\DoxyCodeLine{101 \}}

\end{DoxyCode}


References C\+R\+Y\+P\+T\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+A\+RG, C\+R\+Y\+P\+T\+\_\+\+OK, L\+T\+C\+\_\+\+A\+R\+G\+C\+HK, ltc\+\_\+mp, mp\+\_\+clear\+\_\+multi, mp\+\_\+cmp\+\_\+d, mp\+\_\+copy, mp\+\_\+gcd, mp\+\_\+init\+\_\+multi, mp\+\_\+invmod, mp\+\_\+lcm, mp\+\_\+mod, mp\+\_\+mul, mp\+\_\+set\+\_\+int, mp\+\_\+sub\+\_\+d, ltc\+\_\+math\+\_\+descriptor\+::name, P\+K\+\_\+\+P\+R\+I\+V\+A\+TE, prng\+\_\+is\+\_\+valid(), rand\+\_\+prime(), and rsa\+\_\+free().

Here is the call graph for this function\+:
% FIG 1
